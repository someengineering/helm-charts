name: Test helm chart documentation

on: pull_request

jobs:
  validate-documentation:
    name: validate-docs
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Set up Helm
        uses: azure/setup-helm@v1
        with:
          version: v3.8.1

      - uses: actions/setup-go@v3
        with:
          go-version: '>=1.17.0'
      - run: |
          go version
          GO111MODULE=on go get github.com/norwoodj/helm-docs/cmd/helm-docs

      - name: generate & compare documentation
        run: |
          bash -x ./scripts/validate-docs.sh